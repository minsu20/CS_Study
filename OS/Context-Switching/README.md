# 컨텍스트 스위칭
컨텍스트 스위칭은 프로세스나 스레드가 CPU의 제어를 넘겨받거나 넘겨주는 과정을 말한다. 이 과정은 일반적으로 운영체제의 스케줄러에 의해 처리되며, 여러 프로세스가 동시에 실행되는 것처럼 보이게 한다.


## 프로세스의 컨테스트 스위칭
![image](https://github.com/minsu20/CS_Study/assets/86006389/6ee7822a-62c5-486b-935d-1c38d56a6e6a)

컨텍스트 스위칭 과정
1. 현재 실행 중인 프로세스의 상태를 그 프로세스의 프로세스 제어 블록(PCB)에 저장
2. 다음으로 실행될 프로세스의 PCB를 확인하여 프로세스의 상태를 CPU에 로드
3. 이전에 멈춘 지점부터 프로세스를 계속 실행

 
### 프로세스 제어 블록(Process Control Block, PCB) 이란?
PCB는 운영체제가 각 프로세스를 관리하기 위해 사용하는 자료구조로 프로세스의 PCB에는 그 프로세스의 상태 정보가 저장되며, 이 정보를 통해 운영체제는 프로세스의 실행을 제어
- 프로세스 상태: 프로세스가 현재 어떤 상태(실행 중, 준비, 대기 등)에 있는지를 나타낸다.
- 프로그램 카운터: 다음에 실행할 명령어의 주소를 가리킨다.
- CPU 레지스터: 레지스터에 있는 정보를 복사해둔다.
- CPU 스케줄링 정보: 프로세스의 우선순위, 스케줄링 큐에 대한 포인터 등의 스케줄링과 관련된 정보
- 메모리 관리 정보: 페이지 테이블 정보, 세그먼트 테이블 정보 등 메모리 관리에 필요한 정보
- 입출력 상태 정보: 프로세스에 할당된 입출력 장치들, 열린 파일 목록 등 입출력 상태 정보

### 컨텍스트 스위칭 오버헤드 란?
컨텍스트 스위칭은 과정 자체에 복잡한 동작들이 많이 필요하므로 시스템의 오버헤드를 증가시키고 이를 '컨텍스트 스위칭 오버헤드'라고 한다.  
오버헤드는 컨텍스트 정보를 저장하고 불러오는 데 드는 시간, 캐시 메모리의 일관성을 유지하는 데 필요한 시간, CPU가 유휴 상태에 있는 시간 등을 포함한다. 
따라서 운영체제는 컨텍스트 스위칭의 빈도를 최소화하려고 노력하며, 이는 프로세스 스케줄링 알고리즘을 통해 이루어진다.  


### 프로세스 스케줄링 알고리즘
- **First-Come, First-Served (FCFS):** 이 방식은 먼저 도착한 프로세스를 먼저 처리한다. 간단하고 공평하지만, CPU 버스트 시간이 긴 프로세스가 앞에 오면 짧은 프로세스가 오랫동안 대기해야하는 단점이 있음

- **Shortest Job Next (SJN):** 이 방식은 CPU 버스트 시간이 가장 짧은 프로세스를 먼저 처리한다. 평균 대기 시간을 최소화하며 효율적이지만, 실행 시간을 미리 알아야 하는 단점이 있음

- **Round Robin (RR):** 모든 프로세스가 공평하게 CPU를 사용할 수 있도록, 시간 할당량(quantum)을 정해 그 시간 동안만 CPU를 사용하게 한다. 프로세스는 순환 큐에 저장되어 순차적으로 처리됨

- **Priority Scheduling:** 각 프로세스에 우선순위를 부여하고, 우선순위가 가장 높은 프로세스를 먼저 처리한다. 우선순위가 낮은 프로세스는 '기아 상태'에 빠질 수 있는 단점이 있음

- **Multilevel Queue Scheduling:** 프로세스를 여러 큐에 분류하고, 각 큐는 자신만의 스케줄링 알고리즘을 가진다. 큐 간에도 우선순위가 있을 수 있음



## 스레드의 컨텍스트 스위칭

스레드 컨텍스트 스위칭은 멀티스레딩 환경에서 CPU가 현재 실행 중인 스레드에서 다른 스레드로 변경하는 과정을 말한다.
이는 프로세스 컨텍스트 스위칭과 비슷하지만, 스레드 컨텍스트 스위칭은 같은 프로세스 내의 스레드들 사이에서 발생하기에 전체적으로 볼 때 스레드 컨텍스트 스위칭의 오버헤드는 프로세스 컨텍스트 스위칭보다 훨씬 작다.


1. 현재 실행 중인 스레드의 상태를 그 스레드의 스레드 제어 블록(TCB)에 저장
2. 다음으로 실행될 스레드의 TCB를 확인하여 스레드의 상태를 CPU에 로드
3. 이전에 멈춘 지점부터 스레드를 계속 실행

### 스레드 제어 블록(Thread Control Block, TCB) 이란?
TCB는 운영체제가 각 스레드를 관리하기 위해 사용하는 자료구조로 스레드의 TCB에는 그 스레드의 상태 정보가 저장되며, 이 정보를 통해 운영체제는 스레드의 실행을 제어한다.
- 스레드 상태: 스레드가 현재 어떤 상태(실행 중, 준비, 대기 등)에 있는지를 나타낸다.
- 프로그램 카운터: 다음에 실행할 명령어의 주소를 가리킨다.
- CPU 레지스터: 레지스터에 있는 정보를 복사해 둡니다. 레지스터에는 명령어 실행에 필요한 데이터나 주소 등이 저장된다.
- 스케줄링 정보: 스레드의 우선순위, 스케줄링 큐에 대한 포인터 등의 스케줄링과 관련된 정보이다.

 TCB는 운영체제가 각 스레드의 상태를 추적하고, 뮤텍스나 세마포어 같은 동기화 도구를 사용하여 공유 자원에 대한 동시 접근을 제어하는 데 필요한 정보를 제공한다. 

 ## 프로세스와 스레드의 컨텍스트 스위칭 차이점
1. **가벼운 TCB**: 스레드는 프로세스의 메모리를 공유하기 때문에 관리해야 할 정보가 적어서, 스레드 간의 컨텍스트 스위칭은 프로세스 간의 컨텍스트 스위칭보다 빠르다.
2. **캐시 초기화 여부**: 프로세스 간의 컨텍스트 스위칭은 새로운 프로세스의 데이터를 CPU에 로드하기 위해 CPU 캐시를 초기화해야 하지만, 스레드 간의 컨텍스트 스위칭은 같은 프로세스 내에서 일어나므로 CPU 캐시를 초기화할 필요가 없다.
3. **동기화 문제**: 스레드 컨텍스트 스위칭이 발생하면, 다른 스레드가 공유 자원에 접근하는 동안 동기화 문제가 발생할 수 있다. 프로세스 간의 컨텍스트 스위칭도 비슷한 문제를 가질 수 있지만, 프로세스는 독립된 메모리 공간을 가지므로 이런 문제가 더 적게 발생.
